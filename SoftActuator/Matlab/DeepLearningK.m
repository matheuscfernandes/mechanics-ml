function [Y,Xf,Af] = DeepLearningK(X)
% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1;1;1];
x1_step1.gain = [1;0.5;0.0822537949198858];
x1_step1.ymin = -1;

% Layer 1
b1 = [6.5434166062321601487;-6.2838676157364705688;6.2655223181276893385;5.8782389338810911994;-6.1935789554086708719;6.3893991883845995261;5.8810020808855831831;-5.5434118656332884711;-5.331740923497146234;-5.4601651277466416445;-6.4136459888749817182;-4.7788971795678047982;-5.2078486164912813905;4.6869870698876496817;-4.9375950104823660425;4.2516573595247102446;-4.4811587362236746657;-4.8949030582058474792;-4.19522128458779342;-3.8601989676114505379;-4.0317129065768746443;3.3249262230735885382;-3.1666705551005125407;-3.9245857499705083526;-3.0650649132925340545;-2.9786091751083114687;2.9336590071712276284;2.5493736749611581871;2.554934747641946835;-2.2848636159461661599;2.3167931304763165201;-2.6292509974277904483;-2.8503886239762405985;-2.7137178198870066659;1.9783099979805243152;-1.3955566919123330027;-1.7890265114938579405;1.5597066639977223979;1.3187707695182353529;1.730844277089043981;-1.2885932434829563409;-1.06993182972669576;-1.5696563237488834197;-0.469561738425913755;-0.29404071918862623169;-0.22474023743914040008;-0.74246447413574079288;-0.52680231917113773399;-0.65697369109285019828;0.60598651837187611502;0.5168597378773125417;-0.34513411929099602204;-0.84803480154082866438;-0.17630017924589566625;0.93747240696052314135;0.60540971129024279129;1.0542291435443036374;-1.5940836052648812426;1.2133889551310723665;-1.4489261838362947898;0.84247091437032151084;-1.3568534994909640101;1.3900170189118408182;-1.1178708654591789085;-1.9225237424377643602;0.87207425949373262863;-2.3373371094716013374;2.2631518596158635148;-2.3409020810710678973;2.6382545192335933315;2.2314582513410323727;-2.5943510521428407856;-2.3159100633856128937;-3.3412116412519239361;-3.2887030198144349136;3.1955021737512243618;3.4019593941136521131;3.8170150968905032229;-3.7264054505908656978;4.1906896356399379044;-3.6518324387248322083;-4.6184729355607911927;-4.1985575022678442991;4.8728398746093288807;4.5238506912363227741;-4.824955609175482607;7.0402336717403359856;5.1116104666602382167;4.9982700214089019752;5.2773454997598046035;-5.2705738876503414048;5.8305059770754654735;-5.9360469042052637079;-5.729548364057174048;5.8885174424457806808;5.9933286292663847661;-6.1283309731320869673;6.3892790143441153816;6.5402156842692908967;6.5794485609867559006];
IW1_1 = [-1.82032694814735585 5.1736210109295299731 3.1271714117012612277;1.5375606968985202627 -5.3608673551085290754 0.22102622624617651592;-3.0896065360075630757 -3.3238379105594098029 4.1753250385108025;-4.0272289768398685794 -5.1044246365686287703 -1.3829087266595800898;4.5160310105932195412 2.6811539190320976545 -2.6406691767826830919;-4.6572954901239302927 -2.7844601157723065654 2.7205289353063442093;-0.70518518023944776196 0.6110925743570257973 6.7169187843251432213;4.5161567820876742374 1.6361239513950318614 -4.2811548861965889046;4.4191485404459704966 -0.82914974434785060353 4.8376903478569044381;3.9225449336676505574 4.6380886668654488503 0.77185146672742044327;-0.19733230988034536346 -2.3864048919619880174 -4.5482921018246491585;6.1610401341844358569 -2.2124702994879505979 1.4932134179945646402;1.9559390804540532915 -4.1860635565304704642 4.2034482712781153779;-5.7911194202546747434 2.8630835464699524451 -0.28252000636770774333;2.2956975100990848482 3.0701401410061404107 3.6113035206687542633;-3.1882821712738524944 -4.1926821092793584711 -3.5210950667135398895;2.1269471850329861873 -4.7589467800743987524 -3.0191268810448774751;1.2224999214569018946 0.19614675571575740376 -6.8134730220305854687;5.4346653812573952891 3.1712220313576988673 1.3925983540713171571;0.53276973197617794042 5.9857172591795544392 2.1681111055469060034;5.9407736551026735228 -0.50799703497047943301 2.1843635690921590076;-0.69057521089963791461 3.0762972736096982906 5.5588342387063995886;4.5445861176562987183 2.8697468050910686088 3.8601651125305473933;2.3307860613496407254 3.5103047371530911036 -4.4410301419065758566;1.4931662118743920242 0.70068448007616268569 -5.3727448154112256162;3.8748327574325256428 4.2777370193457100456 -3.1981312878029495295;-4.2394059838963329412 -4.2827521693121157753 -1.6746583361604769902;-0.67632381050396006561 6.3589144688596563881 1.4965570180166323233;-2.7822995435392581243 5.4792154598306019864 -1.6793573547186524397;2.3908153822017395029 4.1997434249059288902 -4.4996950440698180174;-2.0343892045582321337 4.5008798703134189623 3.7538825643762296913;0.74702354063986875499 6.2537264014387474731 0.73931462920283441687;3.9468229511167023382 3.3582027313255293777 2.9389958236261053415;4.9665823295989612873 -0.82922154971065176188 -3.6607694362955287559;-2.991385247148487192 3.7466978318587851327 -4.2638011324113564982;3.7816035212539040877 0.22434682190390653478 5.1093988538753265516;4.2711107081790835593 -4.7924984445751430684 0.13919655899331409565;-4.6518906311358412253 -4.0959214648249107071 -1.6465639117556707394;-3.3868895803169931646 -2.4072703114695221949 -4.8076641748365931406;-1.82635495356944344 -1.1623975050758119654 4.48126758078186338;4.8833306640380769181 -0.10788742606714378514 -4.1245780680844621457;1.3114417606695594198 -2.284001543544641688 5.8986610353307646903;4.5850505322529606644 1.8997701944117444395 4.0749266776946262425;3.0213046637694493946 -4.3855547854977690037 3.6232455088102852869;4.5312559540315966444 4.0349352320389959559 -1.5765052101755006042;6.6183585213214968235 0.017713684228662995163 -0.78615533057615161194;0.24569594422919754928 2.5176102296038278539 4.8850432281056104244;5.9733493135108517436 2.2873226758048121887 0.076276294163607871734;1.513742491912306587 6.1012485825625004665 -1.3662153594662356237;-2.4995176137224262014 -1.6380797801258089041 4.4809593333225130607;-4.592950858498768163 -4.0868350607438568289 -0.36886738868953683479;-1.8177086306762975099 5.4942657300851012181 -2.9588309608720155808;-3.8350650419436842498 4.582602262784000402 1.5493456018752764791;-1.3909713028052543837 -1.8436451267386431141 6.0387498437335489498;4.1963581556031916975 -4.5684039930112021466 -1.4320309872267606988;5.4141744916999625659 -2.9166582087741805829 2.0813682246956592969;5.4314099520425616063 0.25174832442378397568 -3.1383808157900694447;-4.8672280154862788137 -1.9368127133033026244 -3.2868342851672478488;4.5666294134927349901 4.1775342120936906909 1.9954453963388756321;-4.9790511520033113868 -3.8257784677998905032 0.81125211510345518473;1.2463649247880168591 -6.371296515259031068 0.25213436726896176765;-3.0926182542953899457 4.3728256176524418208 3.4046791844386894432;3.604598028113608521 3.4743575147900558342 4.1551752306401201764;-0.33534109163666531161 -2.6918731740917762885 -5.497677403763989723;-2.4533123722043526094 3.6811544173093633248 -4.629623510983818413;3.3583788514060830543 2.2460325005522472352 -4.9302798987759741678;-3.964533078323919657 -4.9721864502521659901 -1.0382924593367597321;1.2596069780794501014 -6.2759549388133439862 -1.1231101446173987757;-2.1797628348598974135 -5.7845050345665702807 -1.8258775917931389099;5.8126301638161779195 -2.6662650709208048916 -0.9535148600655062312;3.7758937884495624715 2.0851380268703509913 -4.1503612119226884758;-3.2143175211074441755 -1.9528371386920935215 5.172587154487183092;-4.7758062050977176938 -1.2571567799404146371 -4.3038201787639795981;-4.2768365930328666735 2.4804798245074826113 -3.9657212860486183992;-3.070163704058790799 -3.3774925600336174192 -4.4483835027500235881;1.5253903390634453441 2.6721843437225420992 5.6246131088190534086;5.6659614482566640348 -0.35490283115437709638 3.2670972229153520949;4.7800632885456062482 1.1756053322005048933 4.0435429746951259133;-5.0289262145702746665 3.8562073996020131972 -0.38345632243245286741;4.1972771397774737423 4.3115449345279284188 1.1084051846977875933;-3.5306896436780328408 -3.8747398284616867414 4.2019637472163973158;-1.7198269900972453783 2.5891937302157108647 -4.7971043193897155987;-5.1047501261735268585 -0.012892299247664849859 -4.0989612047204095902;1.7092573235524615161 -3.1173624371984116621 4.939008454566990558;4.8430511138351892697 0.042295313830108746678 4.0202596728226085432;-3.913134897131771428 3.011525653310274997 -3.7658515905168834514;-0.1200943313122658368 1.1131731012180956508 5.7248643109194681244;0.33921122894101424228 -6.2605363042482879976 -0.65617370666982743899;1.3334220930292421947 -0.39250627232815127332 4.336641221035145044;2.3643957374057138487 -4.9809738199854711738 -3.2476843842610838564;-5.2941735170617700845 -3.05109460373852448 0.87855752199632131116;2.2360550803284833243 -0.2312953191335160863 4.8610529859808178088;-3.8148551070240839245 -3.026695729159038617 3.8822588724285691519;-0.40488799442904804815 5.4846773996854363276 -3.1611156385998659957;2.9491199000966266119 4.3215591643196828997 -3.799061974373674655;1.4520736517119927633 -1.7376176681285611103 -6.0847563314528514411;-3.2901788821011495045 -1.9609073232030425071 5.228512187768354913;4.4630930903515739772 -3.2023312415590381441 -3.0804447655489890501;3.7941004291412747662 2.5088573217763316947 -4.3402899124268392583;3.6602705805544943907 3.9020844867961841373 3.452155172935380989];

% Layer 2
b2 = -1.1283198359702855118;
LW2_1 = [-0.033456177950031348867 0.032467476570718779849 -0.014040805680873166827 -0.021860121164625864743 0.44056472560929010873 0.41901782380190788491 0.23051049430573419818 -0.0048844179564108969327 -0.0022293273954638805241 -0.02964462942471920992 0.12553604051772163097 -0.0056851411448748260039 0.0042363470162821090237 -0.0067215158208297504788 -0.064254565312253861253 0.031112281815065898766 0.017380257555065260766 -0.18113976890370553363 0.00019599282126084991069 0.010014808227794413584 8.7635350250661397335e-05 -0.0076461034755986260342 0.0057803810781578215949 0.011382006356517187368 -0.19847506647965149074 -0.0052872905789921702258 0.02033909719471966443 -0.010442540140357144465 -0.0001374982727803578217 0.0089158967986012437057 -0.007790131922420479027 0.0073794446018517400807 -0.010990542473546914201 0.0061229058072803377311 0.0050650032879568764391 -0.0047721665033884164489 0.005234453669258128973 0.014845908755429534573 -0.001436980574023081483 0.17047080122943678027 0.0086892373907700368174 0.0017762704147723010727 -0.002617897602101485529 -0.0066662373932874271348 -0.010439937049999610183 0.0093391456143496701797 -0.028568041358809869584 -0.0032682789424390268872 0.0028706405979227922649 0.12212996650687595046 0.012690082252621835007 -0.0016885574400472523615 -0.020364463472524088616 0.0028417578869851913351 -0.017300343262659709231 0.00057663348621243316894 0.0082860758103405918878 0.007458154578788159586 -0.0014708923814820431229 0.011860787208893830424 0.0025011220070253795643 -0.0013167273176370123539 -0.0027116125866815674397 0.022660520438945258581 0.0066345795616969474584 -0.083941944602443085977 0.0049491612360733107379 0.00035677891920231683378 0.0016842259589167833493 0.0056223670802713777289 -0.041242653912732206434 0.048519362983847194593 -0.0016360948092569436215 0.00054694293989392757556 0.00044234212460463116605 -0.0090446296320001139113 -0.007280682268602218718 -0.0051656349543473508226 0.0049102788836554714033 -0.01098915975353802546 0.0036072519433935426592 -0.033900018822653719963 -0.016235069217793926533 -0.023411765428174212411 -0.018864331579735910127 0.0037654266149779033399 1.9595044957868090751 -0.0037318410954994976972 0.25532447283285714112 -0.0054374659207053191098 -0.010834909835917739748 -0.13082793495492051061 -0.085844795830154863037 0.0031715573580525708609 0.020347974544946453856 -0.21622773633125494386 0.031992823456499203116 -0.022183691164254528555 -0.82186096597174407297 -0.005325603293783405523];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 50.0357940815319;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
