function [Y,Xf,Af] = DeepLearningP(X)


% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [1;1;0];
x1_step1.gain = [1;0.5;0.0940530733259659];
x1_step1.ymin = -1;

% Layer 1
b1 = [-7.5024909655859088886;10.489801477573113431;5.7041538336714934232;5.6368976137901745105;-6.1264458793578588924;-6.1132673988762382677;5.501039388258897489;-5.0307902746607373601;6.3117710819317505155;6.279320947965219446;5.2533812344851638088;-5.2606963294597335334;-5.1585126014450528587;-5.0306417714483320225;5.7974115710321356687;5.4354584141709896272;5.2325426302387159083;4.0418834706089805664;4.2727983341982431753;3.8946865035650435338;3.9347161727826329702;3.657442037820649805;3.2804014404430699159;2.910675277221842272;-3.1380641720315161081;3.1205447816101496983;2.847777025120289629;2.952183704128835906;3.6846665516355678882;1.8748515070174245345;-2.249327167597900079;2.0199185730454671805;-1.5347765610462589247;1.0520447969371442554;2.6537450056640556895;2.8049695287556137835;-1.5985823323359127368;0.64124853674739790144;-1.6607663673316297448;1.386720175630042684;1.0393756142948564758;-0.93055714903052366704;1.0024042029748092553;1.3195998505825725644;1.3590654099555217194;-0.66543985012391215772;-0.71565343727964358944;-0.55053354613732430334;-0.99365932483855290425;-0.3472449381604065799;0.24672858732721414388;0.49166834717022600554;-1.4290966860806726402;0.24931488679161781241;-0.48131523432262396378;1.198743902848187437;1.2596383818970391388;-1.0631386902005028894;1.5880798334564465435;-0.96394915055191310316;1.2207681999779107507;-0.92095702935505741049;-1.5944155291772621474;-2.3726653202666958542;2.2794065900208395625;-2.6328840822166372782;-1.4692025401334605217;-1.9710626138318725342;2.3116476284314884104;2.2782389202830737318;2.5555061571022257283;-3.6814473288421538655;-3.6956609100611772512;2.3238790603006291846;-3.6274351371138982003;-3.517499155656081733;-4.0079983353416634984;-3.5684837282847823303;-3.8737333698051226172;4.0458730633149295741;3.282380930238420369;3.4220381568326030397;-4.1537465433609588317;-4.8772846546256936051;4.4610944491500967857;4.4907931528790951958;-5.3903142043121858862;-4.359564679314098079;-5.7454437315358930505;-4.9651974729813108667;5.5280365922599266071;-5.2756444574297676198;-6.2994455655122392201;6.2918713680160927026;-6.0967219255163351832;-6.8029852818722114094;-5.8505485520207693995;6.1259760159808687163;6.6414072201163438791;-7.1605470776664423838];
IW1_1 = [5.2983893946680256093 0.67578152188884588192 -1.2496220847358794348;0.49048649650694975399 -0.33330922904608573099 8.7678062632960731548;-3.4186471665253810315 -3.2795442006552297798 -2.9974180497785560817;-0.84305466709983634122 5.3415619250586949818 -0.25230517583653522262;1.8154086721186826203 5.0810579147927379395 -3.1099924576355006955;3.6113819505134276966 2.8962780843637192518 -3.6881058153173698066;-2.6783584226271583972 5.07056207752740562 -3.1001133345070503999;0.94211529071895661058 -3.5640994499307989685 -2.8707825867068041958;-3.8339555768972930494 -3.6189980027806454288 -3.3002772265765845106;-0.39732930064175003837 -0.2287792598712203862 6.4725942222713630514;-4.1580057776295040739 -2.4415729101852243765 3.8658023960201362001;3.5500424317274248409 -5.1603442376405475045 -0.9731333789740432838;5.5260553399677956321 1.0250229676796562828 2.3622545929609204407;3.0324118634280474716 1.2840228753696194541 -4.7807288787645436656;0.34402707425285150578 -0.93054764933586797682 5.3168556367783059713;-4.6536560161688589332 0.33516467337137145766 2.5524301225695560369;-4.1418567279691878014 -2.4298979861267153701 3.8514414539854797681;-0.55297283612672987196 0.66342805185347875074 4.1260645309894741217;-5.7247284828917672783 -2.1458530593815035026 1.9475850723033021339;-1.8832792998693950182 0.50540363848933023139 4.256973155033745293;-0.91424882879382540768 -2.8877159252873108031 -5.6671258134510971161;-2.9794909225114700746 4.9539472227142766769 -2.9490091525056025823;-4.0745207882967919844 -4.2698927696242776619 2.9703980218682399794;-2.4833324900119815304 -5.9791849113772261859 1.9504796980305567633;3.7532869341994850032 5.2326927940514273985 0.008939503905624750224;-1.2365587709136629524 2.7481700464546912066 2.5364009719143605359;-2.71700937625879968 -2.6624324377843016087 4.6389378017784599351;-2.4062792234713494821 -5.7550778822321930761 1.0680168978829824855;0.11905426614542005681 -1.4948933641614052803 4.090334395273128365;-0.76423883484746657491 -6.1313459646201637909 2.4976250421682526515;5.0063009756853746879 2.4188382254980029806 -3.4891974495649464849;-3.8678907771090464962 4.4096377103660682195 -2.9839715783863605125;3.3860808339699635106 2.7445271203289767215 5.0030693459953541335;-2.5888864325275280365 -1.3306004722431310494 -4.5476490485118405971;-3.7968486310328986022 -2.9884829214210744119 -2.6655020765290498019;-3.2954850226413032743 0.61974311433320039555 4.6329369674471188034;2.0107624979284848266 5.8698400619653536836 -1.4201541869124512107;-1.9986949001091833811 -3.1514990013988852802 -4.8630840516602500401;1.4160354937111103713 -2.3837864712595866479 -2.2330487369167264511;-2.6519148451250900145 -1.6100119225798736888 -5.8762834934828598321;-4.3864030371626263616 2.1601277279781538887 -3.9619132785981840961;3.0932642513715822297 -4.3686082508966821436 3.6153201624328867858;-4.1232831960749765088 4.2035866789937106347 0.62719348133511521048;-2.236420801067714681 2.0312580273187719193 5.287856043571125042;-0.15276677232150934205 -3.5613422607832299072 5.2253777438891582108;1.7702983627070723038 -3.3693125497721538864 -3.5212722591926697291;4.9296490030619590783 -4.1913992192171107831 -0.33915174764605859892;1.8865857278540929531 -2.44320128376434198 -1.9928618746430224462;4.1024927432105240399 -4.1852470724413404213 -0.61704213374615768384;0.79310090828034318644 3.8772644367966044854 -4.6960726273394071129;2.8253621969518127877 -4.8056423018010319126 3.0852873593434182453;3.4495822875794797113 -3.4624034846767166584 -2.7746294682431624778;-3.8349414707636970689 1.6467716379281995831 -4.4165954450815094745;2.778098818114517865 -4.7426007676912407263 3.0466549813565526605;-3.2599179613205633288 3.344274935437022922 2.681230246058396105;1.194196830139529375 -5.3859051406080524771 -3.0212678640678882758;0.78195758984605001629 4.184905773550129382 -4.2605136516351063136;-3.7114840946496201468 1.5476453541006116588 4.9504489881206135138;2.042270827963501123 4.3624093539715067536 3.3392429705889883351;-1.7448638036893093783 3.9642151461316017524 3.8558549066255398685;4.7416694294707202317 1.8623670453664102897 3.520908141589882856;-0.53701264063555709249 4.6238229099816656742 4.3858074148311425589;-2.7672330557972242282 2.9961419806260085608 2.4660798737668376823;-2.2940641535753871771 -4.5550210842845757497 3.2324131296675755465;6.0290154183818955858 0.11442891813496780529 -0.97653041344813251712;-4.1083131931770342504 0.92730615832016449751 3.9198709851306401397;-0.90624302295812708685 -0.87290662347637326679 -3.7078306354714150039;-5.8429671132852334381 1.1546955517024628524 -2.4577834267522513656;5.7748908268109815367 -0.67353386599740061591 -2.576598575029917626;3.289563737739002125 1.4681963280739627198 5.4677165291841625105;3.68710544773814064 -4.4194864721686561992 2.3242127117937365632;-2.7256185352359576513 -1.7508220760255057691 -5.046069027353563996;-2.9671167606160691044 3.797133384570410719 3.4150890087795762184;2.5909685262013426588 -2.3486966487847196206 -2.0594422150682407668;-1.0367609032082059084 -0.28833444563400434379 -4.430614704177696872;-0.89267481169237750116 -4.2036438107774882766 3.6735258862252542222;-1.956860970342588768 1.4594726539096782858 -5.1386247468511081493;-4.7672853091305400497 -3.5465520702250352691 1.8773582602572698175;-1.0106206259464958208 -4.6603392410923145661 4.049494478097430239;3.3149463395902443175 4.1461562590422706975 -3.4419737592075216881;1.5597120722368595924 -4.7612029890165530333 -4.3131643798507051102;4.0969295751715302245 -2.6692230425595449006 4.5007728373795190535;-1.4544533590197723516 -2.2684743731874204009 -3.769728871005738835;-1.6328762909710112794 -1.6426506416778718922 -4.9570328610011360482;4.7309225132669965319 -0.5363844644379827109 4.4183235106450018392;1.6143496948985540662 2.6201208458746139129 3.9222173911673765545;-4.4915617273630523698 -1.9466484658305889255 -3.0579551115825651664;-4.1501860807452644053 4.2518876593830308153 -2.461800713113174055;-2.7908224051297887414 3.1453870671007861937 3.9640990379396101595;0.42123281198829209959 -4.9465830241548189861 4.1020206399920979834;3.9769466076763406726 -4.6872959246128438338 1.6669024877447604638;-5.9881259509290680754 -1.7174585729163964753 1.6738324029063529341;-3.5325926613261660059 0.84353500255558211407 -4.1354267547309433439;3.0054040757880478019 2.5555452106778178134 -4.5806981000599416021;-0.87991795576468434525 -3.7823828368869887306 4.9032589274694027281;-3.7149297639428824347 -0.21440551437995442052 -3.2484147405433030364;-4.2094377772650997116 4.191187383969839253 -2.147786227337683318;1.9216476612967292592 4.4853789592768924521 -4.2380421523667841655;4.0460235190527455984 -3.0312956989673813801 -0.28570244075969875031;-2.7397825235440205205 -1.5604587521900745717 5.0975227637226581123];

% Layer 2
b2 = -1.5587266854046888387;
LW2_1 = [-0.0099145065790312673915 3.6812208594807982465 -0.12979820715666809394 0.026989870642562061726 0.0030565547375567721222 -0.0014578409234582223944 0.0032543505077519420919 -0.046303366839941170752 0.11036771443927716196 0.16053660074544293113 0.60085139633139017512 -0.0013125863622356374535 0.0036939215056568594497 -0.0042887380866449154732 0.25199534906417958569 0.0026874851383861322884 -0.60766850019419316187 0.091706516994930181719 0.0014385627791301772594 0.022800225271462800508 0.004656943606803977051 0.0034220262775243861716 -0.00051194317695741470547 0.0032301412564392771067 4.314558089068328689e-05 0.073962769516087545352 -0.0028676952671032032369 -0.0037684335479441196173 0.060665431396973008848 -0.0023713420567817427437 -0.0004036684548499962482 0.0009207575632489948831 -0.0010941594813716857149 -0.0069642208876223203953 -0.0026449792337523573074 0.0043965855067108292747 0.0025820319841374623181 -0.0030434668358453498445 -0.11120443313278781383 0.0011721431631842279056 -0.003436400857912395683 -0.0042265749680513208311 0.49828344061485746463 -0.0049209493166851884724 -0.0070482080441899037232 -0.025531234300184436209 7.2709593771005628145e-05 -0.08588584048433831053 0.50315379692603212636 0.013155587607277467732 -0.39406622124834211895 0.18648119127400716866 -0.0040645893759897111161 0.40241290662136003364 0.24772055681998622623 0.0032263268829222781046 0.024922530923033113515 -0.008119988186902321603 0.0029910067820965121656 0.021458622546152144456 0.0015961975900287161435 0.00024553389419836306896 0.085115237869456822351 0.0094229299449003454947 -0.0053344427217722478751 0.079154688282436505564 -0.022382883178372017796 -0.0026417800195665196682 -0.003845573753650532306 -0.0031015605786177220457 0.010992382759873976436 0.0063240304018698130506 0.043771752253077264583 -0.11556734746139209202 -0.037368953846608099489 -0.42289658308210281712 -0.0011646250548028103718 -0.0021551697197813514568 0.32958322554655050673 -0.0055886559222775907679 -0.012393579193980397771 0.00090995126671575927643 -0.088700566602031419294 0.029343041123793957986 0.0015891122988283469964 -0.056710894673167172586 0.0025864312214332429822 -0.014829819615968756197 1.215745150860899404 0.010562867425342195582 -0.0031693380852225645251 0.0032853388833174916941 -0.0079781812712481046945 0.056938035052210456133 -0.017582368801838499373 0.024943713326117368523 -0.016152916706523631069 0.042790076594462760073 -0.066990270063152654312 1.3721917106765324501];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 71.1483941179924;
y1_step1.xoffset = 0;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end

